<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.613a3714fa9d85827a3b.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.32.13"/><style data-styled="" data-styled-version="5.3.8">.beLylk{top:0;left:0;margin:0 auto;display:block;width:100%;z-index:1000;background-color:rgba(32,35,42,0.85);font-weight:700;}/*!sc*/
@media (min-width:700px){.beLylk{position:fixed;}}/*!sc*/
data-styled.g1[id="Header__HeaderWrapper-sc-1glvhxp-0"]{content:"beLylk,"}/*!sc*/
.bSvLGs{font-weight:700;margin-left:auto;margin-right:auto;height:60px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;max-width:770px;z-index:1000;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;overflow-x:auto;overflow-y:hidden;white-space:nowrap;padding:0px 20px;}/*!sc*/
data-styled.g2[id="Header__HeaderNav-sc-1glvhxp-1"]{content:"bSvLGs,"}/*!sc*/
.gMdjUB{display:none;-webkit-box-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media (min-width:700px){.gMdjUB{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}/*!sc*/
data-styled.g3[id="Header__HeaderLinksContainer-sc-1glvhxp-2"]{content:"gMdjUB,"}/*!sc*/
.eYXESr{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#ffffff;border:0;margin:0;padding:8px 10px;min-width:42px;z-index:10;}/*!sc*/
.Header__HeaderLink-sc-1glvhxp-3 + .Header__HeaderLink-sc-1glvhxp-3{margin-left:0.7rem;}/*!sc*/
data-styled.g4[id="Header__HeaderLink-sc-1glvhxp-3"]{content:"eYXESr,"}/*!sc*/
.cNDYfe{padding-left:0;}/*!sc*/
data-styled.g5[id="Header__HeaderLinkTitle-sc-1glvhxp-4"]{content:"cNDYfe,"}/*!sc*/
.gcQwuc{display:block;padding-left:0;}/*!sc*/
data-styled.g6[id="Header__HeaderLinkTitleContent-sc-1glvhxp-5"]{content:"gcQwuc,"}/*!sc*/
.dJWmJS{z-index:30;top:0px;position:relative;color:#ffffff;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;background:transparent;border:none;cursor:pointer;padding:8px 12px;outline:none;-webkit-tap-highlight-color:transparent;}/*!sc*/
@media (min-width:700px){.dJWmJS{display:none;}}/*!sc*/
data-styled.g10[id="Header__BurgerButton-sc-1glvhxp-9"]{content:"dJWmJS,"}/*!sc*/
.BZsJM{width:24px;height:2px;background:#ffffff;position:absolute;left:0;background:#ffffff;-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
.BZsJM::before{content:'';top:-8px;width:24px;height:2px;background:#ffffff;position:absolute;left:0;-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
.BZsJM::after{top:8px;content:'';width:24px;height:2px;background:white;position:absolute;left:0;-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
data-styled.g11[id="Header__BurgerContent-sc-1glvhxp-10"]{content:"BZsJM,"}/*!sc*/
.bZZuNd{text-align:left;padding-top:30px;padding-bottom:50px;background-color:#3E4047;color:#ffffff;padding-left:20px;padding-right:20px;margin:0 auto;}/*!sc*/
.bZZuNd nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;max-width:900px;margin:0 auto;}/*!sc*/
.bZZuNd nav .footer-col{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin-bottom:1em;padding-right:1em;}/*!sc*/
.bZZuNd a{color:#ffffff;font-weight:bold;}/*!sc*/
.bZZuNd a:hover{color:#CFCFD1;}/*!sc*/
.bZZuNd .footer-col > p{margin:0;}/*!sc*/
.bZZuNd .footer-title{margin:0 0 1rem;}/*!sc*/
.bZZuNd .footer-item{padding:0.25rem 0;color:#ffffff;}/*!sc*/
.bZZuNd .footer-heart{color:red;}/*!sc*/
.bZZuNd .footer-item-text{padding:0.1rem 0;color:#ffffff;}/*!sc*/
.bZZuNd .footer-header{-webkit-order:1;-ms-flex-order:1;order:1;margin:0 0.25rem;margin-right:0.25rem;padding:0.25rem;}/*!sc*/
@media (max-width:564px){.bZZuNd .footer-col:first-child{width:100%;}}/*!sc*/
data-styled.g12[id="Footer__FooterWrapper-sc-t92llg-0"]{content:"bZZuNd,"}/*!sc*/
*{box-sizing:border-box;margin:0;padding:0;}/*!sc*/
body{font-family:"Lato",sans-serif;color:#3E4047;background-color:#f4f8fb;}/*!sc*/
img{max-width:100%;height:auto;vertical-align:middle;border:0;}/*!sc*/
a{-webkit-text-decoration:none;text-decoration:none;color:#3E4047;}/*!sc*/
hr{border:0;border-top:1px solid #ECECED;margin:50px 0 5px 0;}/*!sc*/
ul,ol{padding-left:2em;margin:1em 0 0 0;}/*!sc*/
*::selection{background-color:#ffdc4e;}/*!sc*/
data-styled.g13[id="sc-global-bWaZNT1"]{content:"sc-global-bWaZNT1,"}/*!sc*/
.fCQgYt{line-height:1.6;margin:1em 0 0 0;}/*!sc*/
data-styled.g15[id="Commons__Text-sc-1aaxjtz-1"]{content:"fCQgYt,"}/*!sc*/
.bbfjCq{display:inline-block;color:#697980;margin:0 4px;}/*!sc*/
.bbfjCq::before{content:'•';}/*!sc*/
data-styled.g16[id="Commons__Bull-sc-1aaxjtz-2"]{content:"bbfjCq,"}/*!sc*/
.byspqc{margin:0 0;}/*!sc*/
@media (min-width:700px){.byspqc{margin:60px 0;}}/*!sc*/
data-styled.g17[id="layout__SiteContent-sc-nrr2ov-0"]{content:"byspqc,"}/*!sc*/
.gLFCRx{position:relative;border-radius:5px;width:80%;max-width:770px;word-wrap:break-word;background-color:#ffffff;margin:0px auto 30px auto;top:30px;padding:50px;box-shadow:0 0 0 0,0 6px 12px rgba(0,0,0,0.1);}/*!sc*/
@media (max-width:780px){.gLFCRx{width:100%;padding:25px;}}/*!sc*/
data-styled.g18[id="Wrapper-sc-xmiwfw-0"]{content:"gLFCRx,"}/*!sc*/
.bdeuoL{position:relative;display:table;width:100%;height:400px;overflow:hidden;background-repeat:no-repeat;background-position:center;background-size:cover;}/*!sc*/
data-styled.g23[id="Hero__HeroContainer-sc-1wsaguq-0"]{content:"bdeuoL,"}/*!sc*/
.llhUZh{display:table-cell;vertical-align:middle;text-align:center;width:100%;}/*!sc*/
data-styled.g24[id="Hero__TitleContainer-sc-1wsaguq-1"]{content:"llhUZh,"}/*!sc*/
.eGvyVS{font-weight:700;font-size:3rem;margin:10px 50px;color:#ffffff;text-shadow:1px 1px 4px rgba(34,34,34,0.85);}/*!sc*/
data-styled.g25[id="Hero__HeroTitle-sc-1wsaguq-2"]{content:"eGvyVS,"}/*!sc*/
.lhQztB{display:inline;color:#697980;}/*!sc*/
data-styled.g27[id="TagList__ListContainer-sc-tgjq80-0"]{content:"lhQztB,"}/*!sc*/
.kZSdOS{text-transform:uppercase;color:#697980;}/*!sc*/
.kZSdOS:not(:first-child){margin-left:0.3rem;}/*!sc*/
.kZSdOS:hover{border-bottom:1px dotted #57595d;}/*!sc*/
.kZSdOS:before{content:'#';}/*!sc*/
data-styled.g28[id="TagList__TagListItemLink-sc-tgjq80-1"]{content:"kZSdOS,"}/*!sc*/
.kWMwkB{text-transform:uppercase;color:#697980;}/*!sc*/
.kWMwkB:not(:first-child){margin-left:0.3rem;}/*!sc*/
.kWMwkB:before{content:'#';}/*!sc*/
data-styled.g29[id="TagList__TagListItem-sc-tgjq80-2"]{content:"kWMwkB,"}/*!sc*/
.LLImc .author-image{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-40px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;z-index:2;box-shadow:#ececec 0 0 0 1px;background-color:#ffffff;}/*!sc*/
.LLImc .author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:center center;border-radius:100%;}/*!sc*/
.LLImc .author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0 auto;box-shadow:none;}/*!sc*/
data-styled.g42[id="Bio__BioWrapper-sc-d7fgaq-0"]{content:"LLImc,"}/*!sc*/
.kJMedD a{box-shadow:0 2px 0 0 #ffdc4e;}/*!sc*/
.kJMedD a:hover{-webkit-filter:brightness(150%);filter:brightness(150%);box-shadow:none;}/*!sc*/
data-styled.g43[id="Bio__BioText-sc-d7fgaq-1"]{content:"kJMedD,"}/*!sc*/
.fUDAyc{margin-bottom:2rem;color:#57595d;font-size:0.9em;}/*!sc*/
data-styled.g47[id="ContentHeader__Header-sc-1qtxhip-0"]{content:"fUDAyc,"}/*!sc*/
.iNOQJu{line-height:1.6;}/*!sc*/
.iNOQJu > h2{padding-top:3rem;margin-top:3rem;border-top:1px solid #ececec;}/*!sc*/
.iNOQJu > h3{padding-top:3rem;}/*!sc*/
.iNOQJu > p{margin:1em 0 0 0;}/*!sc*/
.iNOQJu a{box-shadow:0 2px 0 0 #ffdc4e;}/*!sc*/
.iNOQJu a:hover{-webkit-filter:brightness(150%);filter:brightness(150%);box-shadow:none;}/*!sc*/
.iNOQJu a.anchor,.iNOQJu a.gatsby-resp-image-link{box-shadow:none;}/*!sc*/
.iNOQJu h1 .anchor svg,.iNOQJu h2 .anchor svg,.iNOQJu h3 .anchor svg,.iNOQJu h4 .anchor svg,.iNOQJu h5 .anchor svg,.iNOQJu h6 .anchor svg{visibility:hidden;margin-left:-16px;}/*!sc*/
.iNOQJu h1:hover .anchor svg,.iNOQJu h2:hover .anchor svg,.iNOQJu h3:hover .anchor svg,.iNOQJu h4:hover .anchor svg,.iNOQJu h5:hover .anchor svg,.iNOQJu h6:hover .anchor svg,.iNOQJu h1 .anchor:focus svg,.iNOQJu h2 .anchor:focus svg,.iNOQJu h3 .anchor:focus svg,.iNOQJu h4 .anchor:focus svg,.iNOQJu h5 .anchor:focus svg,.iNOQJu h6 .anchor:focus svg{visibility:visible;}/*!sc*/
.iNOQJu > blockquote{box-sizing:border-box;background-color:#f7f7f7;border-left:5px solid rgb(244,213,36);margin:30px 0px;padding:5px 20px;border-radius:0 8px 8px 0;}/*!sc*/
.iNOQJu > blockquote p{margin:0.8em 0;font-style:italic;}/*!sc*/
.iNOQJu .gatsby-highlight{border-radius:5px;font-size:15px;line-height:1.7;border-radius:10px;overflow:auto;tab-size:1.5em;margin:1.5em -1.5em;}/*!sc*/
@media (max-width:500px){.iNOQJu .gatsby-highlight{border-radius:0;margin-left:-25px;margin-right:-25px;}}/*!sc*/
.iNOQJu .gatsby-highlight > pre{border:0;margin:0;padding:1;}/*!sc*/
.iNOQJu .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;}/*!sc*/
.iNOQJu .gatsby-highlight-code-line{background-color:#022a4b;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;border-left:0.25em solid #ffdc4e;}/*!sc*/
.iNOQJu h1 > code.language-text,.iNOQJu h2 > code.language-text,.iNOQJu h3 > code.language-text,.iNOQJu h4 > code.language-text,.iNOQJu h5 > code.language-text,.iNOQJu h6 > code.language-text,.iNOQJu a > code.language-text,.iNOQJu p > code.language-text,.iNOQJu li > code.language-text,.iNOQJu em > code.language-text,.iNOQJu strong > code.language-text{background:#fff9d9;color:#222222cc;padding:0 3px;font-size:0.94em;border-radius:0.3rem;word-wrap:break-word;}/*!sc*/
.iNOQJu code{word-wrap:break-word;}/*!sc*/
.iNOQJu table{margin-top:1em;border-collapse:collapse;border-radius:0.5em;overflow:hidden;}/*!sc*/
.iNOQJu table th,.iNOQJu table td{padding:0.5em;background:#f7f7f7;border-bottom:2px solid #ffffff;}/*!sc*/
data-styled.g48[id="Content__ContentBody-sc-p0bolz-0"]{content:"iNOQJu,"}/*!sc*/
.gqFXtA{padding:0 30px 30px;}/*!sc*/
@media only screen and (max-width:500px){.gqFXtA{padding:0;}}/*!sc*/
data-styled.g49[id="Article__ArticleWrapper-sc-jwdbi9-0"]{content:"gqFXtA,"}/*!sc*/
.jJwhJP{position:relative;margin:6rem 0 0;padding:3rem 0 0;border-top:1px solid #ececec;}/*!sc*/
data-styled.g50[id="Article__ArticleFooter-sc-jwdbi9-1"]{content:"jJwhJP,"}/*!sc*/
.ljGRQe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;max-width:770px;width:80%;margin:0px auto 30px auto;top:20px;position:relative;}/*!sc*/
@media (max-width:780px){.ljGRQe{width:100%;padding:25px;}}/*!sc*/
data-styled.g51[id="PrevNextPost__PreviewContainer-sc-1r1qyep-0"]{content:"ljGRQe,"}/*!sc*/
.kQwcEm{cursor:pointer;-webkit-flex:1 1 300px;-ms-flex:1 1 300px;flex:1 1 300px;background-color:#ffffff;box-shadow:0 0 0 0,0 6px 12px rgba(0,0,0,0.1);margin:20px 20px;border-radius:5px;}/*!sc*/
.kQwcEm:hover{box-shadow:0 0 0 0,0 6px 12px #B2B3B5;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;-webkit-transform:translate3D(0,-1px,0);-ms-transform:translate3D(0,-1px,0);transform:translate3D(0,-1px,0);}/*!sc*/
@media (min-width:780px){.kQwcEm:first-child{margin-left:0;}.kQwcEm:last-child{margin-right:0;}}/*!sc*/
data-styled.g52[id="PrevNextPost__Preview-sc-1r1qyep-1"]{content:"kQwcEm,"}/*!sc*/
.gWjtnY{width:auto;height:200px;background:#c5d2d9 no-repeat 50%;background-size:cover;border-radius:5px 5px 0 0;}/*!sc*/
data-styled.g53[id="PrevNextPost__PreviewCover-sc-1r1qyep-2"]{content:"gWjtnY,"}/*!sc*/
.fnSZzA{padding:20px;}/*!sc*/
.fnSZzA header{padding:0 0 10px 0;}/*!sc*/
.fnSZzA section{padding-bottom:10px;}/*!sc*/
.fnSZzA footer{font-size:0.8em;}/*!sc*/
data-styled.g54[id="PrevNextPost__PreviewContent-sc-1r1qyep-3"]{content:"fnSZzA,"}/*!sc*/
.bbCAMJ{text-transform:uppercase;color:#697980;}/*!sc*/
data-styled.g56[id="Commons__ReadingTimeContainer-sc-1aaxjtz-3"]{content:"bbCAMJ,"}/*!sc*/
.fDomXN{color:#697980;}/*!sc*/
data-styled.g57[id="Time__TimeContainer-sc-1u6vd0l-0"]{content:"fDomXN,"}/*!sc*/
</style><title data-react-helmet="true">쿠버네티스에 Zookeeper 제대로 배포하기 | Devnori&#x27;s Tech Blog</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Lato:400,700&amp;display=swap" rel="stylesheet"/><link data-react-helmet="true" rel="canonical" href="https://Sungchul-P.github.io/zookeeper-on-k8s"/><meta data-react-helmet="true" name="description" content="쿠버네티스 공식 문서 튜토리얼 중 “분산 시스템 코디네이터 Zookeeper…"/><meta data-react-helmet="true" property="og:url" content="https://Sungchul-P.github.io/zookeeper-on-k8s"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="쿠버네티스에 Zookeeper 제대로 배포하기 | Devnori&#x27;s Tech Blog"/><meta data-react-helmet="true" property="og:description" content="쿠버네티스 공식 문서 튜토리얼 중 “분산 시스템 코디네이터 Zookeeper…"/><meta data-react-helmet="true" property="og:image" content="https://Sungchul-P.github.io/static/3421b22668f1163a9a6490d0df595375/zk_logo.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content=""/><meta data-react-helmet="true" name="twitter:title" content="쿠버네티스에 Zookeeper 제대로 배포하기 | Devnori&#x27;s Tech Blog"/><meta data-react-helmet="true" name="twitter:description" content="쿠버네티스 공식 문서 튜토리얼 중 “분산 시스템 코디네이터 Zookeeper…"/><meta data-react-helmet="true" name="twitter:image" content="https://Sungchul-P.github.io/static/3421b22668f1163a9a6490d0df595375/zk_logo.png"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-F68KCEBSGZ', 'auto', {});
      
      
      
      
      
      }</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'G-F68KCEBSGZ');</script><link rel="icon" href="/favicon-32x32.png?v=f44b04687339c42b72dd22b8447a726f" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#222222"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=f44b04687339c42b72dd22b8447a726f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=f44b04687339c42b72dd22b8447a726f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=f44b04687339c42b72dd22b8447a726f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=f44b04687339c42b72dd22b8447a726f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=f44b04687339c42b72dd22b8447a726f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=f44b04687339c42b72dd22b8447a726f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=f44b04687339c42b72dd22b8447a726f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=f44b04687339c42b72dd22b8447a726f"/><link as="script" rel="preload" href="/webpack-runtime-3addde89858b18712ae3.js"/><link as="script" rel="preload" href="/framework-8de36d3fd07627b19105.js"/><link as="script" rel="preload" href="/app-b3fd3eb1dc260f918a8b.js"/><link as="script" rel="preload" href="/styles-29147cbc04bbc833f6a0.js"/><link as="script" rel="preload" href="/3a2f1ab89072400eb78a258db61265f1964eff8a-8f8eed1747c24875300b.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-73aef64fd53c7c31b11f.js"/><link as="fetch" rel="preload" href="/page-data/zookeeper-on-k8s/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1182710729.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1956263691.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-F68KCEBSGZ" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="Header__HeaderWrapper-sc-1glvhxp-0 beLylk"><nav class="Header__HeaderNav-sc-1glvhxp-1 bSvLGs"><a aria-label="View home page" class="Header__HeaderLink-sc-1glvhxp-3 Header__HeaderLinkTitle-sc-1glvhxp-4 eYXESr cNDYfe" href="/"><span class="Header__HeaderLinkTitleContent-sc-1glvhxp-5 gcQwuc">Devnori&#x27;s Tech Blog</span></a><div class="Header__HeaderLinksContainer-sc-1glvhxp-2 gMdjUB"><a aria-label="View Blog page" class="Header__HeaderLink-sc-1glvhxp-3 eYXESr" href="/">Blog</a><a aria-label="View About page" class="Header__HeaderLink-sc-1glvhxp-3 eYXESr" href="/about-me">About</a></div><button aria-label="open menu" class="Header__BurgerButton-sc-1glvhxp-9 dJWmJS"><div class="Header__BurgerContent-sc-1glvhxp-10 BZsJM"></div></button></nav></header><div class="layout__SiteContent-sc-nrr2ov-0 byspqc"><div style="background-image:url(&quot;/static/3421b22668f1163a9a6490d0df595375/zk_logo.png&quot;)" class="Hero__HeroContainer-sc-1wsaguq-0 bdeuoL"><div class="Hero__TitleContainer-sc-1wsaguq-1 llhUZh"><h1 class="Hero__HeroTitle-sc-1wsaguq-2 eGvyVS">쿠버네티스에 Zookeeper 제대로 배포하기</h1></div></div><main role="main" class="Wrapper-sc-xmiwfw-0 gLFCRx"><article class="Article__ArticleWrapper-sc-jwdbi9-0 gqFXtA"><section><header class="ContentHeader__Header-sc-1qtxhip-0 fUDAyc"><time class="Time__TimeContainer-sc-1u6vd0l-0 fDomXN">May 29, 2022</time><span class="Commons__Bull-sc-1aaxjtz-2 bbfjCq"></span><div class="TagList__ListContainer-sc-tgjq80-0 lhQztB"><a class="TagList__TagListItemLink-sc-tgjq80-1 kZSdOS" href="/tags/kubernetes">kubernetes</a>, <a class="TagList__TagListItemLink-sc-tgjq80-1 kZSdOS" href="/tags/statefulset">statefulset</a>, <a class="TagList__TagListItemLink-sc-tgjq80-1 kZSdOS" href="/tags/liveness">liveness</a>, <a class="TagList__TagListItemLink-sc-tgjq80-1 kZSdOS" href="/tags/readiness">readiness</a>, <a class="TagList__TagListItemLink-sc-tgjq80-1 kZSdOS" href="/tags/zookeeper">zookeeper</a></div></header><div class="Content__ContentBody-sc-p0bolz-0 iNOQJu"><blockquote><p>쿠버네티스 공식 문서 튜토리얼 중 “분산 시스템 코디네이터 Zookeeper 실행하기”를 따라 실습하며 정리한 글입니다.
본 글에서 쿠버네티스 기본 개념에 대해서는 직접 다루지 않습니다!
따라서, 쿠버네티스 기본 개념을 숙지하고 쿠버네티스 상에서 Zookeeper 클러스터의 가용성이 어떻게 보장되는지 궁금하신 분께 적합한 글입니다.</p></blockquote><h2 id="시작하기-전에" style="position:relative"><a href="#%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-%EC%A0%84%EC%97%90" aria-label="시작하기 전에 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>시작하기 전에</h2><h3 id="쿠버네티스-클러스터-구성" style="position:relative"><a href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B5%AC%EC%84%B1" aria-label="쿠버네티스 클러스터 구성 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>쿠버네티스 클러스터 구성</h3><p>테스트용으로 간단하게 구성하기 위해, kind(kubernetes in docker)를 사용했습니다.</p><p>실습을 함께 실습하실 분은 <a href="https://kind.sigs.k8s.io/docs/user/quick-start/">kind Quickstart</a> 를 참고하셔서 설치 후, 진행하시면 됩니다. 실습에서 워커 노드를 통제(cordon)하고 비우게(drain)하여 가용성을 테스트하기 때문에 최소 3개 이상의 워커노드가 필요합니다. 이미 구성해놓은 클러스터에서 실습하실 경우, 주의하시기 바랍니다.</p><p>이 실습에서는 퍼시스턴스볼륨(PV)을 스테이트풀셋(StatefulSets)에 volumeClaimTemplates로 정의하여 동적으로 프로비저닝 되도록 합니다. 클러스터에 볼륨 동적 구성이 설정되어 있지 않다면 수동으로 3개의 20GiB 볼륨 프로비저닝해야 합니다.</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># 1 control plane node and 4 workers</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kind.x<span class="token punctuation">-</span>k8s.io/v1alpha4
<span class="token key atrule">nodes</span><span class="token punctuation">:</span>
  <span class="token comment"># the control plane node config</span>
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> control<span class="token punctuation">-</span>plane
  <span class="token comment"># the three workers</span>
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
  <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker</code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kind create cluster <span class="token parameter variable">--config</span> kind-config.yaml</code></pre></div><h2 id="zookeeper" style="position:relative"><a href="#zookeeper" aria-label="zookeeper permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Zookeeper</h2><p>ZooKeeper는 분산 애플리케이션을 위한 분산 오픈 소스 코디네이션 서비스입니다. 다시 말해, ‘분산 작업을 제어하기 위한 트리 형태의 데이터 저장소’라고 할 수 있습니다.</p><p>Zookeeper의 기능은 사실상 단순합니다. 디렉터리 구조기반으로 znode라는 데이터 저장 객체(key-value식)를 제공하고, 이 객체에 데이터를 넣고 빼는 기능만을 제공합니다. 일단 디렉터리 형식을 사용하기 때문에 데이터를 계층화된 구조로 저장하기 용이합니다. 이 기능을 어떻게 조합하느냐에 따라 분산 서버 간의 정보 공유, 서버 투입/제거 시 이벤트 처리, 서버 모니터링, 시스템 관리, 분산 락 처리, 장애 상황 판단 등 다양한 분야에서 활용됩니다.</p><h3 id="zookeeper-앙상블ensemble이란" style="position:relative"><a href="#zookeeper-%EC%95%99%EC%83%81%EB%B8%94ensemble%EC%9D%B4%EB%9E%80" aria-label="zookeeper 앙상블ensemble이란 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Zookeeper 앙상블(Ensemble)이란?</h3><p>이 코디네이션 서비스는 분산 작업을 제어하기 위해 사용되는 만큼 ZooKeeper 서버가 중단되면 ZooKeeper에 의존하는 모든 서버가 영향을 받습니다. 따라서 ZooKeeper는 최대한 정상 동작을 보장하여야 합니다. 이를 위해 여러 대의 ZooKeeper 서버를 클러스터링하여 고가용성을 지원하도록 설정할 수 있습니다. 이 ZooKeeper 클러스터를 앙상블(Ensemble)이라 부릅니다. 이와 같은 특성으로 이미 유명한 분산 솔루션에 많이 사용되고 있습니다. NoSQL의 한 종류인 Apache HBase, 대용량 분산 큐 시스템인 Kafka, 컬럼 기반 분석 데이터베이스 Clickhouse 등이 그 대표적인 사례입니다.</p><p>앙상블로 묶인 ZooKeeper 서버 중 한 대는 쓰기 명령을 총괄하는 리더 역할을 수행하고, 나머지는 팔로워 역할을 수행합니다. 리더 선출과 선거가 완료되기 전까지 앙상블은 데이터를 쓸 수 없습니다. 읽기 명령의 경우, 연결된 서버에서 바로 반환하지만 쓰기 명령은 리더 역할을 수행하는 서버로 전달(Forward)되며 모든 팔로워 서버에게 해당 쓰기를 수행할 수 있는지 질의(Propose)합니다. 팔로워 중 과반수 이상이 쓸 수 있는 상황이라고 응답(ACK)하면 리더는 팔로워들에게 데이터를 쓰도록 지시(Commit)합니다. 승인된 모든 쓰기 명령은 쿼럼에 복제됩니다. 앙상블이 3개 서버인 경우, 리더와 서버로 쿼럼을 구성하며 쿼럼을 달성할 수 없다면 데이터를 쓸 수 없습니다.</p><table><thead><tr><th align="center"><div style="width:600px"> <span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:54.05405405405405%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDUlEQVQoz21RS08TURgdtq71dzTGuBATI4nRSFxgdGGMxI1bNi58JKyMrLC+QGiTaRsgFEWgguhCRBGFgliZ0jKF0il9TB+Z6bQynXbmztyHM1OFGjz5Fifn3u/c7zuXIv8C2wUw4fgcE9tmk7vlqmLqCGNyCBTEBNo6QFjUYBlAoQ54uVZUdRHAEkAl1ZDq4JeBZWj5Ivu+WSanGh46RIqmY4jqiEiViphOKkIxn9zJcgluNxWMxfN7NVFWinsKRAcjUM/ymlcivTl9QMSugqohtFmDL0Q4IpOHW6U7oXQPk+LzhY9c9m4odTtc6M1DWiKegiobiKJGvp7zjrf7Z0+6x1omGcEgzrTS4vlw3jdx0f/WQU8cnePMRwaL+pHRxXbf6wujMw7X2LH3LKdh6t7iz8GZ6b75L/3Tb7p/JBRMlmXj/tw397tZ+tPCo0DgQTRnNi9XUfd8sD8wRX9ecE5N9mykS/Dvziohik1KlYogSVbsTfFiG/9J21IxMs8JQoCQKiIysrw0+88OAVtO6E9o1L5c1SEfXcsxS3x4JRtd2wmvssxqJvLd5JlwMLO+lNlYkWu1xiRkv7lBr6wLjudDp5wDZ5+6O4fHb/j814deXvP6O4dftfV5Wh+7HE/oW6FM80YHzTc3yyci9VYWtG3pHXFwNQEux8Glba0jrp2JgdMsOB5Ru+IyaVrnN+2pNp10KVjJAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/d1fc4dcad56b18361c989d88514084ba/cbe2e/01-zk-ensemble.webp 148w,/static/d1fc4dcad56b18361c989d88514084ba/3084c/01-zk-ensemble.webp 295w,/static/d1fc4dcad56b18361c989d88514084ba/5ca24/01-zk-ensemble.webp 590w,/static/d1fc4dcad56b18361c989d88514084ba/e1262/01-zk-ensemble.webp 834w" sizes="(max-width: 590px) 100vw, 590px" type="image/webp"/>
          <source srcSet="/static/d1fc4dcad56b18361c989d88514084ba/12f09/01-zk-ensemble.png 148w,/static/d1fc4dcad56b18361c989d88514084ba/e4a3f/01-zk-ensemble.png 295w,/static/d1fc4dcad56b18361c989d88514084ba/fcda8/01-zk-ensemble.png 590w,/static/d1fc4dcad56b18361c989d88514084ba/5d72a/01-zk-ensemble.png 834w" sizes="(max-width: 590px) 100vw, 590px" type="image/png"/>
          <img class="gatsby-resp-image-image" src="/static/d1fc4dcad56b18361c989d88514084ba/fcda8/01-zk-ensemble.png" alt="01-zk-ensemble.png" title="01-zk-ensemble.png" loading="lazy" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
    </span> </div></th></tr></thead><tbody><tr><td align="center"><b>Zookeeper 앙상블의 쓰기 요청 처리 절차 (<a href="https://d2.naver.com/helloworld/583580">이미지 출처</a>)</b></td></tr></tbody></table><blockquote><b>쿼럼(Quorum)?</b><p>사전적 의미로는 어떤 일이 발생하였을 때 투표를 통해 의사결정을 진행하는 것을 뜻합니다.
HA에서 말하는 쿼럼이란 클러스터의 분할로 스플릿 브레인(Split-brain)이 발생하는 것을 방지하기 위해 사용하는 알고리즘으로써, 각 노드로부터 투표를 받아 운영(Active) 노드를 결정하는 것을 뜻합니다.</p></blockquote><h2 id="zookeeper-앙상블-생성하기" style="position:relative"><a href="#zookeeper-%EC%95%99%EC%83%81%EB%B8%94-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0" aria-label="zookeeper 앙상블 생성하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Zookeeper 앙상블 생성하기</h2><p>아래 매니페스트(manifest)에는 Headless Service, Service, PodDisruptionBudget, StatefulSet이 포함되어 있습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl apply <span class="token parameter variable">-f</span> https://k8s.io/examples/application/zookeeper/zookeeper.yaml</code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">service/zk-hs created
service/zk-cs created
poddisruptionbudget.policy/zk-pdb created
statefulset.apps/zk created</code></pre></div><p>스테이트풀셋 컨트롤러가 스테이트풀셋 podManagementPolicy에 의해 순차적으로 파드가 생성되는지 확인합니다. replicas 설정에 따라 서버 3개의 Zookeeper 앙상블이 생성됩니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl get pods <span class="token parameter variable">-w</span> <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>zk <span class="token parameter variable">-o</span> wide</code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">NAME   READY   STATUS        RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES
zk-0   <span class="token number">0</span>/1     Pending       <span class="token number">0</span>          0s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-0   <span class="token number">0</span>/1     Pending       <span class="token number">0</span>          0s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       kind-worker3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-0   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          0s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       kind-worker3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-0   <span class="token number">0</span>/1     Running             <span class="token number">0</span>          1s     <span class="token number">10.244</span>.3.4   kind-worker3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-0   <span class="token number">1</span>/1     Running             <span class="token number">0</span>          20s    <span class="token number">10.244</span>.3.4   kind-worker3   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-1   <span class="token number">0</span>/1     Pending             <span class="token number">0</span>          0s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-1   <span class="token number">0</span>/1     Pending             <span class="token number">0</span>          0s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       kind-worker2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-1   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          0s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       kind-worker2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-1   <span class="token number">0</span>/1     Running             <span class="token number">0</span>          1s     <span class="token number">10.244</span>.4.4   kind-worker2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-1   <span class="token number">1</span>/1     Running             <span class="token number">0</span>          20s    <span class="token number">10.244</span>.4.4   kind-worker2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-2   <span class="token number">0</span>/1     Pending             <span class="token number">0</span>          0s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-2   <span class="token number">0</span>/1     Pending             <span class="token number">0</span>          4s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       kind-worker4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-2   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          4s     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       kind-worker4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-2   <span class="token number">0</span>/1     Running             <span class="token number">0</span>          21s    <span class="token number">10.244</span>.1.3   kind-worker4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
zk-2   <span class="token number">1</span>/1     Running             <span class="token number">0</span>          34s    <span class="token number">10.244</span>.1.3   kind-worker4   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span></code></pre></div><h3 id="리더-선출-촉진" style="position:relative"><a href="#%EB%A6%AC%EB%8D%94-%EC%84%A0%EC%B6%9C-%EC%B4%89%EC%A7%84" aria-label="리더 선출 촉진 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>리더 선출 촉진</h3><p>익명 네트워크에서 리더 선출을 위한 종료 알고리즘이 없기에, Zab(Zookeeper Atomic Broadcast)은 리더 선출을 위해 명시적인 멤버 구성을 해야 합니다. 앙상블의 각 서버는 고유 식별자(myid)를 가져야 하고, 모든 서버는 식별자 전역 집합을 알아야 하며, 각 식별자는 네트워크 주소에 연관되어야 합니다.</p><p>ZooKeeper 앙상블에 서버들은 고유 식별자로서 자연수를 이용하고 서버 데이터 디렉터리에 <code class="language-text">myid</code> 라는 파일로 서버 식별자를 저장합니다. 각 서버에서 다음 명령어를 이용하여 <code class="language-text">myid</code> 파일의 내용을 확인합니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;myid zk-<span class="token variable">$i</span>&quot;</span><span class="token punctuation">;</span>kubectl <span class="token builtin class-name">exec</span> zk-<span class="token variable">$i</span> -- <span class="token function">cat</span> /var/lib/zookeeper/data/myid<span class="token punctuation">;</span> <span class="token keyword">done</span></code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">myid zk-0
<span class="token number">1</span>
myid zk-1
<span class="token number">2</span>
myid zk-2
<span class="token number">3</span></code></pre></div><p><code class="language-text">zk</code> 스테이트풀셋의 각 파드 Fully Qualified Domain Name(FQDN)을 얻기 위해 다음 명령어를 이용합니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">do</span> kubectl <span class="token builtin class-name">exec</span> zk-<span class="token variable">$i</span> -- <span class="token function">hostname</span> -f<span class="token punctuation">;</span> <span class="token keyword">done</span></code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">zk-0.zk-hs.zookeeper.svc.cluster.local
zk-1.zk-hs.zookeeper.svc.cluster.local
zk-2.zk-hs.zookeeper.svc.cluster.local</code></pre></div><p>ZooKeeper는 애플리케이션 환경설정을 <code class="language-text">zoo.cfg</code> 파일에 저장하며, <code class="language-text">server.1</code>, <code class="language-text">server.2</code>, <code class="language-text">server.3</code> 속성에서 <code class="language-text">1</code>, <code class="language-text">2</code>, <code class="language-text">3</code>은 ZooKeeper 서버의 <code class="language-text">myid</code>
파일에 구분자와 연관됩니다. 이 속성들은 <code class="language-text">zk</code> 스테이트풀셋 파드의 FQDN을 설정합니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-0 -- <span class="token function">cat</span> /opt/zookeeper/conf/zoo.cfg</code></pre></div><div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/var/lib/zookeeper/data
<span class="token assign-left variable">dataLogDir</span><span class="token operator">=</span>/var/lib/zookeeper/log
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token assign-left variable">maxClientCnxns</span><span class="token operator">=</span><span class="token number">60</span>
<span class="token assign-left variable">minSessionTimeout</span><span class="token operator">=</span> <span class="token number">4000</span>
<span class="token assign-left variable">maxSessionTimeout</span><span class="token operator">=</span> <span class="token number">40000</span>
<span class="token assign-left variable">autopurge.snapRetainCount</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token assign-left variable">autopurge.purgeInterval</span><span class="token operator">=</span><span class="token number">0</span>
<span class="gatsby-highlight-code-line"><span class="token assign-left variable">server.1</span><span class="token operator">=</span>zk-0.zk-hs.default.svc.cluster.local:2888:3888</span><span class="gatsby-highlight-code-line"><span class="token assign-left variable">server.2</span><span class="token operator">=</span>zk-1.zk-hs.default.svc.cluster.local:2888:3888</span><span class="gatsby-highlight-code-line"><span class="token assign-left variable">server.3</span><span class="token operator">=</span>zk-2.zk-hs.default.svc.cluster.local:2888:3888</span></code></pre></div><p>각 파드의 A 레코드는 파드가 Ready 상태가 되면 입력됩니다. 따라서 ZooKeeper 서버의 FQDN은 단일 엔드포인트로 확인되고 해당 엔드포인트는 <code class="language-text">myid</code>
파일에 구성된 식별자를 가진 고유한 ZooKeeper 서버가 됩니다.</p><h3 id="앙상블-무결성sanity-테스트" style="position:relative"><a href="#%EC%95%99%EC%83%81%EB%B8%94-%EB%AC%B4%EA%B2%B0%EC%84%B1sanity-%ED%85%8C%EC%8A%A4%ED%8A%B8" aria-label="앙상블 무결성sanity 테스트 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>앙상블 무결성(Sanity) 테스트</h3><p>가장 기본적인 테스트는 한 ZooKeeper 서버에 데이터를 쓰고 다른 ZooKeeper 서버에서 데이터를 읽는 것입니다.</p><p>아래 명령어는 앙상블 내에 <strong><code class="language-text">zk-0</code></strong> 파드에서 <code class="language-text">zkCli.sh</code>스크립트를 실행하여 <code class="language-text">/hello</code> 경로에 <code class="language-text">world</code>를 쓰게 합니다. (/ping pong 도 마찬가지)</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-0 -- zkCli.sh create /hello world</code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
Created /hello</code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-0 -- zkCli.sh create /ping pong</code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
Created /ping</code></pre></div><p>위 명령을 실행하고 나면 아래와 같이 디렉터리 형식으로 계층 구조 데이터가 저장됩니다.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:528px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:81.75675675675677%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADiElEQVQ4y41US2xbRRQ9854T1WlUYrWkBYRCQEhBqqhaYMOKRUtXfKVQIQGCVUWp2qgSRaSBOLGT97HlNE7KJ6JiiwRIKBGLpO6CfqBVm5BUtVP/nr9NcOIPRXFcx/Yb7tihsEIZ6eiN5p575vqeOwb+u7p1QIkAaoSJr+WbCu2j+wQsE6XNWJRRHFtbr9kpKcwwdAdwBlqhxaYIfBOTdLYdQ8EGZ0vr0EnAlZAJVIkxJIQkV7wiE+qiquGATjGdOFtZ7Nj3wFhBxlgeTDMuQonxR86lNh77IrUh9nTmw2gWGM3JsqVpC4rPvg64UzLcadEvDVqcW9zxioDY05kCF8Vcyf+pUI3WcUr9Csed42hz3GTt9stoPnOljZo/86CHamTaeuZSW9fgBexxXmM9jtF6zj/5/67hEOomaHFpt7Zg4UonPlTP7/zB1bt9zM8hOW6/yAhDQY4p12nrR+r53Vx5Hg9rt2SRU88VGsL5E1MkKFzz5oUgtulhajjHx9qXjz8x/Ku07+CbjVFRwo3Lj9djj3IH2EN6gHLIIG8OD0QFb4e+SIG7sOjRw+ReL1X5vlPRba8oP2K/c1qinyORqGQbvM66lEvgLwFPadd7oMf7JC36MvMsA4N+Egw2RKEmSTk6IFzEMEGp98yLEbp5pMCY/XdgYIEqKbC6w5oxXucIqIJr9DN3isxMSzSnJGhf7GgmF2k8eOfX6TJ9TabHuKxFnkNfCK2eGFVoUKUGmBI+IAxqH0+axCvvOJsQl1eseqgDnyzC6jZo4D8P7G/xJPh7P69u9FzMmW9PrlStHhqR3sDBzom7FDekJneMDIhBUsOHRVXHZrL3j05nTcqpwWlw9N/ee+BbqvKzoITWU5NN1KeFRvkxs2UkyW3eVMy7yDs459s+nfRL+IB61DdHCbM2Gu4EvR5Or6e251ya7xxPz1/N8F3EtZ6+sMTAyO5dLn8X+kMzJ33ZQrKwzoNL+cJKJhMprpf8ROwk4IQvZxFVtqiBF2APXR64WriXyJf4nfTqaqm4ZlRr5k1umjbxMhie9CFOSetVPpxbyfAbc/P8t9l5/ue9v0iLPyMECUw+u8zQPSf2MDmfyK9muO+XK3z2lp9XKpUynbcDZPuRn5ZlXs0SsfZ0jfN3KNBNeIvwxtpasXWtWEShRH9lnjwOfbck38//Qdzq3o0af3eTe6RWq71aLpeb/wbTCiUaAoxY9gAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/9a961e395ef85423f96cb6ec1db3de27/cbe2e/02-zk-znode.webp 148w,/static/9a961e395ef85423f96cb6ec1db3de27/3084c/02-zk-znode.webp 295w,/static/9a961e395ef85423f96cb6ec1db3de27/83811/02-zk-znode.webp 528w" sizes="(max-width: 528px) 100vw, 528px" type="image/webp"/>
          <source srcSet="/static/9a961e395ef85423f96cb6ec1db3de27/12f09/02-zk-znode.png 148w,/static/9a961e395ef85423f96cb6ec1db3de27/e4a3f/02-zk-znode.png 295w,/static/9a961e395ef85423f96cb6ec1db3de27/4af8e/02-zk-znode.png 528w" sizes="(max-width: 528px) 100vw, 528px" type="image/png"/>
          <img class="gatsby-resp-image-image" src="/static/9a961e395ef85423f96cb6ec1db3de27/4af8e/02-zk-znode.png" alt="02-zk-znode.png" title="02-zk-znode.png" loading="lazy" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
    </span></p><p>zk-1 파드에서 데이터를 읽기 명령을 수행합니다. zk-0 파드에서 생성한 데이터를 앙상블 내의 모든 서버에서 사용할 수 있습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-1 -- zkCli.sh get /hello</code></pre></div><div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre class="language-bash"><code class="language-bash">WATCHER::

WatchedEvent state:SyncConnected type:None path:null
cZxid <span class="token operator">=</span> 0x100000002
<span class="gatsby-highlight-code-line">world</span>ctime <span class="token operator">=</span> Sat May <span class="token number">28</span> <span class="token number">16</span>:12:39 UTC <span class="token number">2022</span>
mZxid <span class="token operator">=</span> 0x100000002
mtime <span class="token operator">=</span> Sat May <span class="token number">28</span> <span class="token number">16</span>:12:39 UTC <span class="token number">2022</span>
pZxid <span class="token operator">=</span> 0x100000002
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
<span class="gatsby-highlight-code-line">dataLength <span class="token operator">=</span> <span class="token number">5</span></span>numChildren <span class="token operator">=</span> <span class="token number">0</span></code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-2 -- zkCli.sh get /ping</code></pre></div><div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre class="language-bash"><code class="language-bash">WATCHER::

WatchedEvent state:SyncConnected type:None path:null
cZxid <span class="token operator">=</span> 0x100000004
<span class="gatsby-highlight-code-line">pong</span>ctime <span class="token operator">=</span> Sat May <span class="token number">28</span> <span class="token number">16</span>:12:58 UTC <span class="token number">2022</span>
mZxid <span class="token operator">=</span> 0x100000004
mtime <span class="token operator">=</span> Sat May <span class="token number">28</span> <span class="token number">16</span>:12:58 UTC <span class="token number">2022</span>
pZxid <span class="token operator">=</span> 0x100000004
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
<span class="gatsby-highlight-code-line">dataLength <span class="token operator">=</span> <span class="token number">4</span></span>numChildren <span class="token operator">=</span> <span class="token number">0</span></code></pre></div><h3 id="내구성있는-저장소-제공" style="position:relative"><a href="#%EB%82%B4%EA%B5%AC%EC%84%B1%EC%9E%88%EB%8A%94-%EC%A0%80%EC%9E%A5%EC%86%8C-%EC%A0%9C%EA%B3%B5" aria-label="내구성있는 저장소 제공 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>내구성있는 저장소 제공</h3><p>ZooKeeper는 모든 항목을 내구성있는 WAL(Write Ahead Log)에 커밋하고 메모리 상태의 스냅샷을 저장 미디어에 주기적으로 저장합니다. 내구성을 제공하기 위해 WAL을 이용하는 것은 복제된 상태 머신을 이루는 합의(consensus) 프로토콜에서 이용하는 일반적인 기법입니다.</p><p>zk 스테이트풀셋을 삭제한 후에, 다시 생성합니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl delete statefulset zk
kubectl apply <span class="token parameter variable">-f</span> https://k8s.io/examples/application/zookeeper/zookeeper.yaml</code></pre></div><p>zk 스테이트풀셋은 spec에 퍼시스턴트 볼륨을 지정하여 프로비저닝 되도록 하고, 데이터 디렉터리에 마운트 하여 저장소로 활용합니다. (같은 이름으로 생성되어 있는 경우, 마운트만 다시하여 유지됩니다.)</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">spec</span><span class="token punctuation">:</span>
	<span class="token punctuation">...</span> (생략) <span class="token punctuation">...</span>
	<span class="token key atrule">template</span><span class="token punctuation">:</span>
		<span class="token key atrule">spec</span><span class="token punctuation">:</span>
			<span class="token punctuation">...</span> (생략) <span class="token punctuation">...</span>
			<span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> datadir
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/lib/zookeeper
	<span class="token key atrule">volumeClaimTemplates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> datadir
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;ReadWriteOnce&quot;</span> <span class="token punctuation">]</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token key atrule">requests</span><span class="token punctuation">:</span>
          <span class="token key atrule">storage</span><span class="token punctuation">:</span> 10Gi</code></pre></div><p>파드는 지워지더라도 퍼시스턴트 볼륨(PV)는 그대로 남아있기 때문에 재성성된 앙상블은 여전히 원래 값을 돌려줄 수 있습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl get pvc <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>zk</code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">NAME           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
datadir-zk-0   Bound    pvc-2e44d658-014b-41c1-987e-5d4566520bad   10Gi       RWO            standard       86m
datadir-zk-1   Bound    pvc-15667394-b722-4f25-9de1-ae049ce9de83   10Gi       RWO            standard       85m
datadir-zk-2   Bound    pvc-7d4bd962-59b9-4697-b24b-1946f0947cb0   10Gi       RWO            standard       83m</code></pre></div><p>앙상블이 재생성되면 zk-2 파드에서 무결성 테스트를 위해 생성한 데이터를 읽어옵니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-2 -- zkCli.sh get /hello</code></pre></div><div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre class="language-bash"><code class="language-bash">WATCHER::

WatchedEvent state:SyncConnected type:None path:null
world
<span class="gatsby-highlight-code-line">cZxid <span class="token operator">=</span> 0x100000002</span>ctime <span class="token operator">=</span> Sat May <span class="token number">28</span> <span class="token number">16</span>:12:39 UTC <span class="token number">2022</span>
mZxid <span class="token operator">=</span> 0x100000002
mtime <span class="token operator">=</span> Sat May <span class="token number">28</span> <span class="token number">16</span>:12:39 UTC <span class="token number">2022</span>
pZxid <span class="token operator">=</span> 0x100000002
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
<span class="gatsby-highlight-code-line">dataLength <span class="token operator">=</span> <span class="token number">5</span></span>numChildren <span class="token operator">=</span> <span class="token number">0</span></code></pre></div><h2 id="일관된-구성-보장하기" style="position:relative"><a href="#%EC%9D%BC%EA%B4%80%EB%90%9C-%EA%B5%AC%EC%84%B1-%EB%B3%B4%EC%9E%A5%ED%95%98%EA%B8%B0" aria-label="일관된 구성 보장하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>일관된 구성 보장하기</h2><p>ZooKeeper 앙상블 서버는 리더 선출과 쿼럼을 구성하기 위한 일관된 설정이 필요합니다. 스테이트풀셋에 파라미터로 환경 구성을 전달하여 일관된 구성을 달성할 수 있습니다. 환경 변수를 이용해서도 앙상블에 구성을 전달할 수 있습니다.</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>zookeeper
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#x27;k8s.gcr.io/kubernetes-zookeeper:1.0-3.4.10&#x27;</span>
    <span class="token key atrule">commnad</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sh
      <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
      <span class="token punctuation">-</span> &quot;start<span class="token punctuation">-</span>zookeeper \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>servers=3 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>data_dir=/var/lib/zookeeper/data \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>data_log_dir=/var/lib/zookeeper/data/log \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>conf_dir=/opt/zookeeper/conf \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>client_port=2181 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>election_port=3888 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>server_port=2888 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>tick_time=2000 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>init_limit=10 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>sync_limit=5 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>heap=512M \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>max_client_cnxns=60 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>snap_retain_count=3 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>purge_interval=12 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>max_session_timeout=40000 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>min_session_timeout=4000 \
        <span class="token punctuation">-</span><span class="token punctuation">-</span>log_level=INFO&quot;</code></pre></div><h2 id="zookeeper-프로세스-관리하기" style="position:relative"><a href="#zookeeper-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EA%B4%80%EB%A6%AC%ED%95%98%EA%B8%B0" aria-label="zookeeper 프로세스 관리하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Zookeeper 프로세스 관리하기</h2><p>ZooKeeper의 서버 프로세스(JVM)를 관리할 감독 프로세스가 필요합니다. 와치독(감독 프로세스)를 활용하여 실패한 프로세스를 재시작하는 것은 분산시스템에서 일반적인 방식입니다. 쿠버네티스에서 애플리케이션을 배포할 때에는 감독 프로세스로 외부 유틸리티를 사용하기보다 쿠버네티스를 애플리케이션의 와치독으로서 사용해야 합니다.</p><h3 id="앙상블-관리하기" style="position:relative"><a href="#%EC%95%99%EC%83%81%EB%B8%94-%EA%B4%80%EB%A6%AC%ED%95%98%EA%B8%B0" aria-label="앙상블 관리하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>앙상블 관리하기</h3><p>zk 스테이트풀셋은 RollingUpdate 업데이트 전략을 이용하도록 구성되었습니다. 업데이트를 수행하면 파드를 역순으로 한 번에 하나씩 종료하고, 새로운 구성으로 재생성합니다. 이는 롤링업데이트 동안에 쿼럼을 유지하도록 보장합니다.</p><p><code class="language-text">kubectl patch</code>로 서버에 할당된 cpu 수를 갱신하고, 업데이트 상황을 확인합니다.</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">kubectl patch sts zk <span class="token punctuation">-</span><span class="token punctuation">-</span>type=&#x27;json&#x27; <span class="token punctuation">-</span>p=&#x27;<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token key atrule">&quot;op&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;replace&quot;</span><span class="token punctuation">,</span> <span class="token key atrule">&quot;path&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;/spec/template/spec/containers/0/resources/requests/cpu&quot;</span><span class="token punctuation">,</span> &quot;value&quot;<span class="token punctuation">:</span><span class="token string">&quot;0.7&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>&#x27;</code></pre></div><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">kubectl rollout status sts/zk</code></pre></div><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:25.675675675675674%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQY0z2P4Y6CMBCEeSCjJwgCBUEopaWFAlXwUFFyufd/hRv8cclks9nszLdruVQ7tA5yHZd9xPq1YcZLlR2Jr7B0T3JP+OFU7UlpE25HHNVNpJfIrU8tM/2qy5vpqR4WdV0bfftJxDWkGhEJN16iCO2OaR1kDeRnDRgg7YLCUsPC+2euxsrMop9zdWvGJaQtaIAcUwUy+DjkEFfOKoE45G79wpJmLtt7JkfePri+n6tBmGfMev9cYzUqOngAhN9La3ggQlvMdwGD+SW6B8yIYM1UNN/q8sLnNhHYc6KV86FJ8jln4+X/+gOCx1ERHp8rmQAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/718128423ce97ba00cd745a3ebb69638/cbe2e/03-rollout.webp 148w,/static/718128423ce97ba00cd745a3ebb69638/3084c/03-rollout.webp 295w,/static/718128423ce97ba00cd745a3ebb69638/5ca24/03-rollout.webp 590w,/static/718128423ce97ba00cd745a3ebb69638/dad35/03-rollout.webp 885w,/static/718128423ce97ba00cd745a3ebb69638/2baf0/03-rollout.webp 1180w,/static/718128423ce97ba00cd745a3ebb69638/f3c7c/03-rollout.webp 1392w" sizes="(max-width: 590px) 100vw, 590px" type="image/webp"/>
          <source srcSet="/static/718128423ce97ba00cd745a3ebb69638/12f09/03-rollout.png 148w,/static/718128423ce97ba00cd745a3ebb69638/e4a3f/03-rollout.png 295w,/static/718128423ce97ba00cd745a3ebb69638/fcda8/03-rollout.png 590w,/static/718128423ce97ba00cd745a3ebb69638/efc66/03-rollout.png 885w,/static/718128423ce97ba00cd745a3ebb69638/c83ae/03-rollout.png 1180w,/static/718128423ce97ba00cd745a3ebb69638/e8814/03-rollout.png 1392w" sizes="(max-width: 590px) 100vw, 590px" type="image/png"/>
          <img class="gatsby-resp-image-image" src="/static/718128423ce97ba00cd745a3ebb69638/fcda8/03-rollout.png" alt="03-rollout" title="03-rollout" loading="lazy" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
    </span></p><h3 id="프로세스-장애-관리하기" style="position:relative"><a href="#%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%9E%A5%EC%95%A0-%EA%B4%80%EB%A6%AC%ED%95%98%EA%B8%B0" aria-label="프로세스 장애 관리하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>프로세스 장애 관리하기</h3><p>재시작 정책은 쿠버네티스가 파드 내에 컨테이너의 진입점에서 프로세스 실패를 어떻게 다루는지 제어할 수 있습니다. <code class="language-text">스테이트풀셋</code>의 파드에서 오직 적절한 <code class="language-text">재시작 정책</code>는 Always이며 이것이 기본 값입니다. 상태가 유지되는 애플리케이션을 위해 기본 정책을 <strong>절대로</strong> 변경하지 않습니다.</p><p>zk-0 파드에서 실행 중인 Zookeeper 서버의 프로세스 트리는 다음과 같습니다. start-zookeeper 스크립트 프로세스가 Zookeeper(Java) 프로세스를 실행시키는 구조입니다.</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">kubectl exec zk<span class="token punctuation">-</span>0 <span class="token punctuation">-</span><span class="token punctuation">-</span> ps <span class="token punctuation">-</span>ef</code></pre></div><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">UID          PID    PPID  C STIME TTY          TIME CMD
zookeep+       1       0  0 17<span class="token punctuation">:</span>19 <span class="token punctuation">?</span>        00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>00 /usr/bin/qemu<span class="token punctuation">-</span>x86_64 /bin/sh sh <span class="token punctuation">-</span>c start<span class="token punctuation">-</span>zookeeper <span class="token punctuation">-</span><span class="token punctuation">-</span>servers=3 <span class="token punctuation">-</span><span class="token punctuation">-</span>data_dir=/var/lib/zookeeper/data <span class="token punctuation">-</span><span class="token punctuation">-</span>data_log_dir=/var/lib/zookeeper/data/log <span class="token punctuation">-</span><span class="token punctuation">-</span>conf_dir=/opt/zookeeper/conf <span class="token punctuation">-</span><span class="token punctuation">-</span>client_port=2181 <span class="token punctuation">-</span><span class="token punctuation">-</span>election_port=3888 <span class="token punctuation">-</span><span class="token punctuation">-</span>server_port=2888 <span class="token punctuation">-</span><span class="token punctuation">-</span>tick_time=2000 <span class="token punctuation">-</span><span class="token punctuation">-</span>init_limit=10 <span class="token punctuation">-</span><span class="token punctuation">-</span>sync_limit=5 <span class="token punctuation">-</span><span class="token punctuation">-</span>heap=512M <span class="token punctuation">-</span><span class="token punctuation">-</span>max_client_cnxns=60 <span class="token punctuation">-</span><span class="token punctuation">-</span>snap_retain_count=3 <span class="token punctuation">-</span><span class="token punctuation">-</span>purge_interval=12 <span class="token punctuation">-</span><span class="token punctuation">-</span>max_session_timeout=40000 <span class="token punctuation">-</span><span class="token punctuation">-</span>min_session_timeout=4000 <span class="token punctuation">-</span><span class="token punctuation">-</span>log_level=INFO
zookeep+      11       1  1 17<span class="token punctuation">:</span>19 <span class="token punctuation">?</span>        00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>06 /usr/bin/qemu<span class="token punctuation">-</span>x86_64 /usr/lib/jvm/java<span class="token punctuation">-</span>8<span class="token punctuation">-</span>openjdk<span class="token punctuation">-</span>amd64/bin/java /usr/lib/jvm/java<span class="token punctuation">-</span>8<span class="token punctuation">-</span>openjdk<span class="token punctuation">-</span>amd64/bin/java <span class="token punctuation">-</span>Dzookeeper.log.dir=/var/log/zookeeper <span class="token punctuation">-</span>Dzookeeper.root.logger=INFO<span class="token punctuation">,</span><span class="token key atrule">CONSOLE -cp /usr/bin/../build/classes:/usr/bin/../build/lib/*.jar:/usr/bin/../share/zookeeper/zookeeper-3.4.10.jar:/usr/bin/../share/zookeeper/slf4j-log4j12-1.6.1.jar:/usr/bin/../share/zookeeper/slf4j-api-1.6.1.jar:/usr/bin/../share/zookeeper/netty-3.10.5.Final.jar:/usr/bin/../share/zookeeper/log4j-1.2.16.jar:/usr/bin/../share/zookeeper/jline-0.9.94.jar:/usr/bin/../src/java/lib/*.jar:/usr/bin/../etc/zookeeper</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>Xmx512M <span class="token punctuation">-</span>Xms512M <span class="token punctuation">-</span>Dcom.sun.management.jmxremote <span class="token punctuation">-</span>Dcom.sun.management.jmxremote.local.only=false org.apache.zookeeper.server.quorum.QuorumPeerMain /usr/bin/../etc/zookeeper/zoo.cfg</code></pre></div><p>Zookeeper 프로세스를 종료하면 부모 프로세스(start-zookeeper 스크립트)의 종료를 일으킵니다. 컨테이너 재시작 정책에 의해 부모 프로세스를 재시작하여 정상화 됩니다.</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">kubectl exec zk<span class="token punctuation">-</span>0 <span class="token punctuation">-</span><span class="token punctuation">-</span> pkill java</code></pre></div><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">kubectl get pod <span class="token punctuation">-</span>w <span class="token punctuation">-</span>l app=zk <span class="token punctuation">-</span>o wide</code></pre></div><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:16.216216216216214%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqklEQVQI1w2MSQ6CMAAAeQ6KElH2rbSlZWkphUYQCAfPejAefb29TTKTMVL+KKqesikZ9ohIhOuwWd31Z4m3yV+O+tjqe4CzlzdxKX3A3ayNUB8UnZPUBuJzTMcQCjbuqJ0uSXNLK0R7whQoRY55r7aiGhCbYTsdXZhViojlHJR2SAzM5pyOXs6o3DINgEVYplSVYq3lnpCR359agVrptXkFuiTdcvKx5aE/7v8xrj7pqiIAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/c50f08f0d462bde68202101cb11b51c2/cbe2e/04-restore.webp 148w,/static/c50f08f0d462bde68202101cb11b51c2/3084c/04-restore.webp 295w,/static/c50f08f0d462bde68202101cb11b51c2/5ca24/04-restore.webp 590w,/static/c50f08f0d462bde68202101cb11b51c2/dad35/04-restore.webp 885w,/static/c50f08f0d462bde68202101cb11b51c2/2baf0/04-restore.webp 1180w,/static/c50f08f0d462bde68202101cb11b51c2/94107/04-restore.webp 1694w" sizes="(max-width: 590px) 100vw, 590px" type="image/webp"/>
          <source srcSet="/static/c50f08f0d462bde68202101cb11b51c2/12f09/04-restore.png 148w,/static/c50f08f0d462bde68202101cb11b51c2/e4a3f/04-restore.png 295w,/static/c50f08f0d462bde68202101cb11b51c2/fcda8/04-restore.png 590w,/static/c50f08f0d462bde68202101cb11b51c2/efc66/04-restore.png 885w,/static/c50f08f0d462bde68202101cb11b51c2/c83ae/04-restore.png 1180w,/static/c50f08f0d462bde68202101cb11b51c2/966c1/04-restore.png 1694w" sizes="(max-width: 590px) 100vw, 590px" type="image/png"/>
          <img class="gatsby-resp-image-image" src="/static/c50f08f0d462bde68202101cb11b51c2/fcda8/04-restore.png" alt="04-restore" title="04-restore" loading="lazy" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
    </span></p><h3 id="활성도liveness-테스트하기" style="position:relative"><a href="#%ED%99%9C%EC%84%B1%EB%8F%84liveness-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%98%EA%B8%B0" aria-label="활성도liveness 테스트하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>활성도(Liveness) 테스트하기</h3><p>시스템의 프로세스는 살아있지만 응답이 없을 수 있고, 혹은 다른 문제로 비정상 상태일 경우의 시나리오도 있습니다. 애플리케이션 프로세스가 정상이 아니고, 재시작해야하는 상황임을 쿠버네티스에 알릴 수 있도록 활성도 검사를 주기적으로 해야 합니다. 활성도 검사는 다음과 같이 명시할 수 있습니다.</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">exec</span><span class="token punctuation">:</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sh
      <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
      <span class="token punctuation">-</span> <span class="token string">&#x27;zookeeper-ready 2181&#x27;</span>
  <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">15</span>
  <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span></code></pre></div><p>본 실습에서 사용된 컨테이너 이미지(k8s.gcr.io/kubernetes-zookeeper:1.0-3.4.10)에는 zookeeper-ready 스크립트가 생성되어 있는데, 내용은 간단합니다. Zookeeper 클라이언트 포트로 <code class="language-text">ruok</code> 메시지를 전송했을 때, <code class="language-text">imok</code>로 응답이 오는 것을 기준으로 활성도를 검사할 수 있습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">OK</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> ruok <span class="token operator">|</span> <span class="token function">nc</span> <span class="token number">127.0</span>.0.1 <span class="token number">2181</span><span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$OK</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;imok&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span></code></pre></div><p>livenessProbe에서 사용하는 zookeeper-ready 스크립트를 삭제하여, 활성도 검사를 실패하도록 유도합니다. 활성도 검사에 실패하면 자동으로 프로세스를 재시작하여 파드 재시작을 보증합니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-0 -- <span class="token function">rm</span> /opt/zookeeper/bin/zookeeper-ready</code></pre></div><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:17.567567567567565%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA10lEQVQI1xXGi06DMBhAYR7HZFtQqqLQFmhLL38L9ALb3ERNfAGT6QP45s7k5MvJtAp0PD3YQ82AdRzpM1p/t/Gyid8309cuXbbpZ4PHvGQIG4T1tbtK3pP/z7CeuTtCXGsZe7+WraXCEe4EhKo1VAw2HImKz9xPL59XC2JaONjlA1HIGmqUDCm+UmI4GxsKQvhe+BTfLOw5n5b5Pfoz64YwncqS5zmWMjhYdgXNRCVtNyQzi1rNsHgZJDGaQtTJiVERs9i9V7EnOpqZPrKnWwydC/1UoOYPCfVDG6URbwIAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/e4bbd0471585484a60295d94a6a40317/cbe2e/05-liveness.webp 148w,/static/e4bbd0471585484a60295d94a6a40317/3084c/05-liveness.webp 295w,/static/e4bbd0471585484a60295d94a6a40317/5ca24/05-liveness.webp 590w,/static/e4bbd0471585484a60295d94a6a40317/dad35/05-liveness.webp 885w,/static/e4bbd0471585484a60295d94a6a40317/2baf0/05-liveness.webp 1180w,/static/e4bbd0471585484a60295d94a6a40317/e5be3/05-liveness.webp 1700w" sizes="(max-width: 590px) 100vw, 590px" type="image/webp"/>
          <source srcSet="/static/e4bbd0471585484a60295d94a6a40317/12f09/05-liveness.png 148w,/static/e4bbd0471585484a60295d94a6a40317/e4a3f/05-liveness.png 295w,/static/e4bbd0471585484a60295d94a6a40317/fcda8/05-liveness.png 590w,/static/e4bbd0471585484a60295d94a6a40317/efc66/05-liveness.png 885w,/static/e4bbd0471585484a60295d94a6a40317/c83ae/05-liveness.png 1180w,/static/e4bbd0471585484a60295d94a6a40317/dcb79/05-liveness.png 1700w" sizes="(max-width: 590px) 100vw, 590px" type="image/png"/>
          <img class="gatsby-resp-image-image" src="/static/e4bbd0471585484a60295d94a6a40317/fcda8/05-liveness.png" alt="05-liveness" title="05-liveness" loading="lazy" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
    </span></p><h3 id="준비도readiness-테스트" style="position:relative"><a href="#%EC%A4%80%EB%B9%84%EB%8F%84readiness-%ED%85%8C%EC%8A%A4%ED%8A%B8" aria-label="준비도readiness 테스트 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>준비도(readiness) 테스트</h3><p>준비도 검사를 지정하면, 쿠버네티스는 준비도가 통과할 때까지 애플리케이션 프로세스가 네트워크 트래픽을 수신하지 않게 합니다. ZooKeeper 서버에서는 준비도가 활성도를 내포합니다. 그러므로 준비도 검사는 활성도 검사와 동일합니다.</p><p>활성도와 준비도 검사가 동일함에도 둘 다 지정하는 것은 중요합니다. 이는 ZooKeeper 앙상블의 헬스체크 뿐만 아니라 네트워크 트래픽 수신도 보장합니다.</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">exec</span><span class="token punctuation">:</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sh
      <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
      <span class="token punctuation">-</span> <span class="token string">&#x27;zookeeper-ready 2181&#x27;</span>
  <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">15</span>
  <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span></code></pre></div><h2 id="노드-실패-방지" style="position:relative"><a href="#%EB%85%B8%EB%93%9C-%EC%8B%A4%ED%8C%A8-%EB%B0%A9%EC%A7%80" aria-label="노드 실패 방지 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>노드 실패 방지</h2><p>서버 3개의 앙상블에서 성공적으로 저장하려면 서버 2개는 반드시 정상상태여야 합니다. 기본적으로 쿠버네티스는 동일 노드상에 스테이트풀셋의 파드를 여러개 배치시킬 수 있습니다. 서버 3개 중 2개가 같은 노드에 있다면 해당 노드 장애 발생 시 Zookeeper 서비스 클라이언트는 최소 2개중 1개가 재스케쥴링될 때까지 서비스 중단이 발생합니다.</p><p>노드에 문제가 생기더라도 중요 시스템의 프로세스가 재스케쥴링될 수 있게 항상 추가적인 용량을 확보해야 합니다. 그렇게 하면 쿠버네티스 스케줄러가 Zookeeper 서버 하나를 재스케쥴링하는 동안만 서비스가 중단될 것입니다. 그러나 서비스에서 노드 장애로 인한 다운타임을 방지하려면 podAntiAffinity를 설정해야 합니다.</p><div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">affinity</span><span class="token punctuation">:</span>
  <span class="token key atrule">podAntiAffinity</span><span class="token punctuation">:</span>
    <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">labelSelector</span><span class="token punctuation">:</span>
          <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">&#x27;app&#x27;</span>
              <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
              <span class="token key atrule">values</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> zk
        <span class="token key atrule">topologyKey</span><span class="token punctuation">:</span> <span class="token string">&#x27;kubernetes.io/hostname&#x27;</span></code></pre></div><p>requiredDuringSchedulingIgnoredDuringExecution 필드는 쿠버네티스 스케쥴러에 topologyKey로 정의된 도메인에서 app이 zk라고 레이블링된 파드가 한 개 이상 배치되지 않도록 합니다. 즉, 노드별로 같은 애플리케이션 파드는 한 개씩만 배치되게 됩니다. 다른 규칙과 레이블, 셀렉터를 사용하여 앙상블을 물리적, 네트워크, 전원 장애 분야에 걸쳐 확산하도록 이 기법을 확장할 수 있습니다.</p><h2 id="유지-보수" style="position:relative"><a href="#%EC%9C%A0%EC%A7%80-%EB%B3%B4%EC%88%98" aria-label="유지 보수 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>유지 보수</h2><p>계획된 점검으로 인해 발생하는 일시적인 노드 다운타임에 대한 계획도 필요합니다. 예상 가능한 시나리오일 때 다운타임없이 재구성할 수 있는 방법을 cordon, drain을 이용하여 알아보겠습니다.</p><p>업그레이드 또는 복구 등의 작업으로 비자발적인 중단일 경우에도 일시에 중지되는 파드의 수를 제한할 수 있습니다. PodDisruptionBudget의 max-unavailable 필드는 쿠버네티스가 스테이트풀셋에서 최대 1개의 파드는 언제든지 다운될 수 있음을 나타냅니다. 다르게 말하면, 파드 1개 이상이 동시에 다운되는 것은 허용하지 않는다는 것입니다.</p><p><code class="language-text">zk-0</code>파드가 스케줄되는 노드를 통제하기 위해 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands/#drain">kubectl drain</a>를 이용합니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl drain <span class="token variable"><span class="token variable">$(</span>kubectl get pod zk-0 <span class="token parameter variable">--template</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>.spec.nodeName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">)</span></span> --ignore-daemonsets <span class="token parameter variable">--force</span> --delete-emptydir-data</code></pre></div><div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="gatsby-highlight-code-line">node/kind-worker3 cordoned</span>WARNING: ignoring DaemonSet-managed Pods: kube-system/kindnet-rxqbw, kube-system/kube-proxy-tl8hh
evicting pod zookeeper/zk-0
pod/zk-0 evicted
<span class="gatsby-highlight-code-line">node/kind-worker3 drained</span></code></pre></div><p>이 실습에서는 local path provisioner를 이용하여 볼륨을 동적 프로비저닝 했기 때문에, 볼륨이 노드에 종속되어 별도의 작업(스토리지 복제, 애플리케이션 복제 등)없이 다른 노드에 스케쥴링하는 것이 불가능 합니다.</p><div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl describe <span class="token function">pv</span> pvc-2e44d658-014b-41c1-987e-5d4566520bad

Name:              pvc-2e44d658-014b-41c1-987e-5d4566520bad
Labels:            <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="gatsby-highlight-code-line">Annotations:       pv.kubernetes.io/provisioned-by: rancher.io/local-path</span>Finalizers:        <span class="token punctuation">[</span>kubernetes.io/pv-protection<span class="token punctuation">]</span>
StorageClass:      standard
Status:            Bound
<span class="gatsby-highlight-code-line">Claim:             zookeeper/datadir-zk-0</span>Reclaim Policy:    Delete
Access Modes:      RWO
VolumeMode:        Filesystem
Capacity:          10Gi
<span class="gatsby-highlight-code-line">Node Affinity:</span><span class="gatsby-highlight-code-line">  Required Terms:</span><span class="gatsby-highlight-code-line">    Term <span class="token number">0</span>:        kubernetes.io/hostname <span class="token keyword">in</span> <span class="token punctuation">[</span>kind-worker3<span class="token punctuation">]</span></span>Message:
Source:
    Type:          HostPath <span class="token punctuation">(</span>bare <span class="token function">host</span> directory volume<span class="token punctuation">)</span>
    Path:          /var/local-path-provisioner/pvc-2e44d658-014b-41c1-987e-5d4566520bad_zookeeper_datadir-zk-0
    HostPathType:  DirectoryOrCreate
Events:            <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span></code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl describe pod zk-0 <span class="token operator">|</span> <span class="token function">grep</span> Event <span class="token parameter variable">-A5</span>

Events:
  Type     Reason            Age                 From               Message
  ----     ------            ----                ----               -------
  Warning  FailedScheduling  54s <span class="token punctuation">(</span>x12 over 56m<span class="token punctuation">)</span>  default-scheduler  <span class="token number">0</span>/5 nodes are available: <span class="token number">4</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> had volume <span class="token function">node</span> affinity conflict.</code></pre></div><p>현재 상황을 다시 정리해보자면, zk-0 파드가 스케쥴 되지 못하고 중단된 상태입니다. zk-0 파드가 사용중이던 볼륨(PV)이 있는 kind-worker3 노드가 통제(cordon) 상태이기 때문에 별도의 조치 없이는 스케쥴 될 수 없는 상황입니다.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:38.513513513513516%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJklEQVQozz2OzUsVURjGzyZX3lq16H8IDMJt/0C0adGihVCppJAUmJRCoaVeKyrtbygCkYxWLbRN4KJQya56v+fzemfufN75PDNz5ulMRgce3ocf7/O8h4gnvYm6qI7WRGVM0c3bmuMNc3arJqrjXGPcj+puMCyq2khd7hRsVFC6d7u2d1nWjJG61BmvCsodqdub7JjuRSKd6DhqCjist3HSs+CG9O1/1mij8G4Qr8qmnR+3JRxxcQ/bC1+ousGqLREVnpW7Ogw3eExw+iKulMvzw3iRTzdJM5ZmWYocNACW06bcMyeewRqfj+n+cRGYR57rGWOIaVLkEcb0PikAy3Owf9OP6ErOi+MkBeWlHKW8sBy3O6Y1twZzqpzGNREhsMBYbvDDiGJKi0I/Sh+QIKZX4yS7FifJ9SDBFeoc3IydQyjCLqTWT4T2ETLr+8skanmKuAuhyVnQALN2Fql73O9IexAaPxBYVTBnZ5qYTn+o7wcbnu9/0T0MQX93iWpb/erehtmubJqxtm3A+PA00bdbtf0Nt3mw2fPVrz6s9dm0t9Vq/PrkVvfW9VD7lsL4OElcz39vOy4s2wEv/sx/TiC9OgdnqQS8LkGdKwW/7w2gOTMI7UkJ4fJfFlamBvLG9CCsBb73pgR59ixnZ4gX0fMsx1jK8pl+EF2IPImgcoOXlgmcNQJ1hWT1hyQXlghkzuxVAqVMWOMRydvPT/cKJq8QVp8hfwDbIAlq/Xo5TgAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/a916addaa70a8e488d7cbdcddf21da70/cbe2e/06-cordon-drain.webp 148w,/static/a916addaa70a8e488d7cbdcddf21da70/3084c/06-cordon-drain.webp 295w,/static/a916addaa70a8e488d7cbdcddf21da70/5ca24/06-cordon-drain.webp 590w,/static/a916addaa70a8e488d7cbdcddf21da70/dad35/06-cordon-drain.webp 885w,/static/a916addaa70a8e488d7cbdcddf21da70/60055/06-cordon-drain.webp 888w" sizes="(max-width: 590px) 100vw, 590px" type="image/webp"/>
          <source srcSet="/static/a916addaa70a8e488d7cbdcddf21da70/12f09/06-cordon-drain.png 148w,/static/a916addaa70a8e488d7cbdcddf21da70/e4a3f/06-cordon-drain.png 295w,/static/a916addaa70a8e488d7cbdcddf21da70/fcda8/06-cordon-drain.png 590w,/static/a916addaa70a8e488d7cbdcddf21da70/efc66/06-cordon-drain.png 885w,/static/a916addaa70a8e488d7cbdcddf21da70/b04e4/06-cordon-drain.png 888w" sizes="(max-width: 590px) 100vw, 590px" type="image/png"/>
          <img class="gatsby-resp-image-image" src="/static/a916addaa70a8e488d7cbdcddf21da70/fcda8/06-cordon-drain.png" alt="06-cordon-drain" title="06-cordon-drain" loading="lazy" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
    </span></p><p>이 상태에서 podDisruptionBudget이 제대로 동작하는지 확인하기 위해 zk-1 파드가 스케쥴된 노드를 비워보겠습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl drain <span class="token variable"><span class="token variable">$(</span>kubectl get pod zk-1 <span class="token parameter variable">--template</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>.spec.nodeName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">)</span></span> --ignore-daemonsets <span class="token parameter variable">--force</span> --delete-emptydir-data</code></pre></div><div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="gatsby-highlight-code-line">node/kind-worker2 cordoned</span>WARNING: ignoring DaemonSet-managed Pods: kube-system/kindnet-h6r7d, kube-system/kube-proxy-2bthb
evicting pod zookeeper/zk-1
<span class="gatsby-highlight-code-line">error when evicting pods/<span class="token string">&quot;zk-1&quot;</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;zookeeper&quot;</span> <span class="token punctuation">(</span>will retry after 5s<span class="token punctuation">)</span>: Cannot evict pod as it would violate the pod&#x27;s disruption budget.</span></code></pre></div><p>podDisruptionBudget을 위반하기 때문에 통제(cordon) 상태는 되지만, 파드는 축출(evict) 되지 않는 것을 확인할 수 있습니다. 따라서 여전히 서비스는 가용합니다. 아래와 같이 zk-1 서버에서 데이터를 조회할 수 있습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-1 -- zkCli.sh get /ping</code></pre></div><div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre class="language-bash"><code class="language-bash">WATCHER::

WatchedEvent state:SyncConnected type:None path:null
<span class="gatsby-highlight-code-line">pong</span>cZxid <span class="token operator">=</span> 0x100000004
ctime <span class="token operator">=</span> Sat May <span class="token number">28</span> <span class="token number">16</span>:12:58 UTC <span class="token number">2022</span>
mZxid <span class="token operator">=</span> 0x100000004
mtime <span class="token operator">=</span> Sat May <span class="token number">28</span> <span class="token number">16</span>:12:58 UTC <span class="token number">2022</span>
pZxid <span class="token operator">=</span> 0x100000004
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
<span class="gatsby-highlight-code-line">dataLength <span class="token operator">=</span> <span class="token number">4</span></span>numChildren <span class="token operator">=</span> <span class="token number">0</span></code></pre></div><p>이제 다시 zk-0 파드가 스케쥴되었던 노드(kind-worker3)의 통제를 풀어보겠습니다.(uncordon)</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl uncordon kind-worker3</code></pre></div><p>적용과 동시에 zk-0 파드가 다시 스케쥴되어 정상화되었습니다.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:20.945945945945947%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQI1w3GWW6DMBRAUZaTjyoFQRRseMZgPD0bsA2BVk2nn+5/CUW6OrpZ498YroM/ePqkKvRqJu7jtvzl5uvSH5X/ze33pdZkDFSmkrl7P1MZK+6vRGUGNy4W4C6m56hicRtYh0aHedo5x1FMMbwDs+j2YQwv18bg4+y1YEXVZ8msQkbo3Lb/aLvVVEPnG+as28+x7kB/SJ1CfAoZaGtOW4YELCcyW1QEwLbRVq8MbH0XlKqy7AAMtAbtdir6yeODd06rRIkqcqZkFGD+AWBhQS2pD5+tAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <picture>
          <source srcSet="/static/3b3782d77887f0e2699aa2fad88aa27d/cbe2e/06-uncordon.webp 148w,/static/3b3782d77887f0e2699aa2fad88aa27d/3084c/06-uncordon.webp 295w,/static/3b3782d77887f0e2699aa2fad88aa27d/5ca24/06-uncordon.webp 590w,/static/3b3782d77887f0e2699aa2fad88aa27d/dad35/06-uncordon.webp 885w,/static/3b3782d77887f0e2699aa2fad88aa27d/2baf0/06-uncordon.webp 1180w,/static/3b3782d77887f0e2699aa2fad88aa27d/9ade6/06-uncordon.webp 1726w" sizes="(max-width: 590px) 100vw, 590px" type="image/webp"/>
          <source srcSet="/static/3b3782d77887f0e2699aa2fad88aa27d/12f09/06-uncordon.png 148w,/static/3b3782d77887f0e2699aa2fad88aa27d/e4a3f/06-uncordon.png 295w,/static/3b3782d77887f0e2699aa2fad88aa27d/fcda8/06-uncordon.png 590w,/static/3b3782d77887f0e2699aa2fad88aa27d/efc66/06-uncordon.png 885w,/static/3b3782d77887f0e2699aa2fad88aa27d/c83ae/06-uncordon.png 1180w,/static/3b3782d77887f0e2699aa2fad88aa27d/e7aec/06-uncordon.png 1726w" sizes="(max-width: 590px) 100vw, 590px" type="image/png"/>
          <img class="gatsby-resp-image-image" src="/static/3b3782d77887f0e2699aa2fad88aa27d/fcda8/06-uncordon.png" alt="06-uncordon" title="06-uncordon" loading="lazy" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0"/>
        </picture>
    </span></p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-0 -- zkCli.sh get /hello</code></pre></div><h2 id="리더-재선출-테스트" style="position:relative"><a href="#%EB%A6%AC%EB%8D%94-%EC%9E%AC%EC%84%A0%EC%B6%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8" aria-label="리더 재선출 테스트 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>리더 재선출 테스트</h2><p>현재 앙상블의 리더/팔로워 모드를 확인하고, 리더 서버를 강제 재시작 했을 때 리더의 재선출이 일어나는지 보겠습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;zk-<span class="token variable">$i</span>&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> srvr <span class="token operator">|</span> kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> zk-<span class="token variable">$i</span> -- <span class="token function">nc</span> <span class="token number">127.0</span>.0.1 <span class="token number">2181</span> <span class="token operator">|</span> <span class="token function">grep</span> Mode<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>  <span class="token keyword">done</span></code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">zk-0
Mode: follower

zk-1
Mode: follower

zk-2
Mode: leader</code></pre></div><p>zk-2가 리더이므로, 프로세스를 강제 종료하여 파드가 재시작 되도록 했습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">kubectl <span class="token builtin class-name">exec</span> zk-2 -- <span class="token function">pkill</span> <span class="token function">java</span></code></pre></div><p>재시작 후, zk-2 로그를 살펴보면 아래와 같이 리더 선출이 진행되는 것을 확인할 수 있습니다. 리더였던 zk-2는 팔로워가 되고, zk-1 이 새로운 리더로 선출되었습니다.</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:FileSnap@83<span class="token punctuation">]</span> - Reading snapshot /var/lib/zookeeper/data/version-2/snapshot.100000000
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>ListenerThread:QuorumCnxManager<span class="token variable">$Listener</span>@739<span class="token punctuation">]</span> - My election <span class="token builtin class-name">bind</span> port: zk-2.zk-hs.zookeeper.svc.cluster.local/10.244.1.5:3888
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>QuorumPeer<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>/0:0:0:0:0:0:0:0:2181:QuorumPeer@865<span class="token punctuation">]</span> - LOOKING
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>QuorumPeer<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>/0:0:0:0:0:0:0:0:2181:FastLeaderElection@818<span class="token punctuation">]</span> - New election. My <span class="token function">id</span> <span class="token operator">=</span>  <span class="token number">3</span>, proposed <span class="token assign-left variable">zxid</span><span class="token operator">=</span>0x300000004
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>WorkerReceiver<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>:FastLeaderElection@600<span class="token punctuation">]</span> - Notification: <span class="token number">1</span> <span class="token punctuation">(</span>message <span class="token function">format</span> version<span class="token punctuation">)</span>, <span class="token number">2</span> <span class="token punctuation">(</span>n.leader<span class="token punctuation">)</span>, 0x300000004 <span class="token punctuation">(</span>n.zxid<span class="token punctuation">)</span>, 0x53 <span class="token punctuation">(</span>n.round<span class="token punctuation">)</span>, LOOKING <span class="token punctuation">(</span>n.state<span class="token punctuation">)</span>, <span class="token number">1</span> <span class="token punctuation">(</span>n.sid<span class="token punctuation">)</span>, 0x3 <span class="token punctuation">(</span>n.peerEpoch<span class="token punctuation">)</span> LOOKING <span class="token punctuation">(</span>my state<span class="token punctuation">)</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>WorkerReceiver<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>:FastLeaderElection@600<span class="token punctuation">]</span> - Notification: <span class="token number">1</span> <span class="token punctuation">(</span>message <span class="token function">format</span> version<span class="token punctuation">)</span>, <span class="token number">2</span> <span class="token punctuation">(</span>n.leader<span class="token punctuation">)</span>, 0x300000004 <span class="token punctuation">(</span>n.zxid<span class="token punctuation">)</span>, 0x53 <span class="token punctuation">(</span>n.round<span class="token punctuation">)</span>, FOLLOWING <span class="token punctuation">(</span>n.state<span class="token punctuation">)</span>, <span class="token number">1</span> <span class="token punctuation">(</span>n.sid<span class="token punctuation">)</span>, 0x4 <span class="token punctuation">(</span>n.peerEpoch<span class="token punctuation">)</span> LOOKING <span class="token punctuation">(</span>my state<span class="token punctuation">)</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>WorkerReceiver<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>:FastLeaderElection@600<span class="token punctuation">]</span> - Notification: <span class="token number">1</span> <span class="token punctuation">(</span>message <span class="token function">format</span> version<span class="token punctuation">)</span>, <span class="token number">3</span> <span class="token punctuation">(</span>n.leader<span class="token punctuation">)</span>, 0x300000004 <span class="token punctuation">(</span>n.zxid<span class="token punctuation">)</span>, 0x1 <span class="token punctuation">(</span>n.round<span class="token punctuation">)</span>, LOOKING <span class="token punctuation">(</span>n.state<span class="token punctuation">)</span>, <span class="token number">3</span> <span class="token punctuation">(</span>n.sid<span class="token punctuation">)</span>, 0x3 <span class="token punctuation">(</span>n.peerEpoch<span class="token punctuation">)</span> LOOKING <span class="token punctuation">(</span>my state<span class="token punctuation">)</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>WorkerReceiver<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>:FastLeaderElection@600<span class="token punctuation">]</span> - Notification: <span class="token number">1</span> <span class="token punctuation">(</span>message <span class="token function">format</span> version<span class="token punctuation">)</span>, <span class="token number">3</span> <span class="token punctuation">(</span>n.leader<span class="token punctuation">)</span>, 0x300000004 <span class="token punctuation">(</span>n.zxid<span class="token punctuation">)</span>, 0x53 <span class="token punctuation">(</span>n.round<span class="token punctuation">)</span>, LOOKING <span class="token punctuation">(</span>n.state<span class="token punctuation">)</span>, <span class="token number">3</span> <span class="token punctuation">(</span>n.sid<span class="token punctuation">)</span>, 0x3 <span class="token punctuation">(</span>n.peerEpoch<span class="token punctuation">)</span> LOOKING <span class="token punctuation">(</span>my state<span class="token punctuation">)</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>WorkerReceiver<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>:FastLeaderElection@600<span class="token punctuation">]</span> - Notification: <span class="token number">1</span> <span class="token punctuation">(</span>message <span class="token function">format</span> version<span class="token punctuation">)</span>, <span class="token number">2</span> <span class="token punctuation">(</span>n.leader<span class="token punctuation">)</span>, 0x300000004 <span class="token punctuation">(</span>n.zxid<span class="token punctuation">)</span>, 0x53 <span class="token punctuation">(</span>n.round<span class="token punctuation">)</span>, LOOKING <span class="token punctuation">(</span>n.state<span class="token punctuation">)</span>, <span class="token number">2</span> <span class="token punctuation">(</span>n.sid<span class="token punctuation">)</span>, 0x3 <span class="token punctuation">(</span>n.peerEpoch<span class="token punctuation">)</span> LOOKING <span class="token punctuation">(</span>my state<span class="token punctuation">)</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>WorkerReceiver<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>:FastLeaderElection@600<span class="token punctuation">]</span> - Notification: <span class="token number">1</span> <span class="token punctuation">(</span>message <span class="token function">format</span> version<span class="token punctuation">)</span>, <span class="token number">2</span> <span class="token punctuation">(</span>n.leader<span class="token punctuation">)</span>, 0x300000004 <span class="token punctuation">(</span>n.zxid<span class="token punctuation">)</span>, 0x53 <span class="token punctuation">(</span>n.round<span class="token punctuation">)</span>, FOLLOWING <span class="token punctuation">(</span>n.state<span class="token punctuation">)</span>, <span class="token number">1</span> <span class="token punctuation">(</span>n.sid<span class="token punctuation">)</span>, 0x4 <span class="token punctuation">(</span>n.peerEpoch<span class="token punctuation">)</span> LOOKING <span class="token punctuation">(</span>my state<span class="token punctuation">)</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>WorkerReceiver<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>:FastLeaderElection@600<span class="token punctuation">]</span> - Notification: <span class="token number">1</span> <span class="token punctuation">(</span>message <span class="token function">format</span> version<span class="token punctuation">)</span>, <span class="token number">2</span> <span class="token punctuation">(</span>n.leader<span class="token punctuation">)</span>, 0x300000004 <span class="token punctuation">(</span>n.zxid<span class="token punctuation">)</span>, 0x53 <span class="token punctuation">(</span>n.round<span class="token punctuation">)</span>, LEADING <span class="token punctuation">(</span>n.state<span class="token punctuation">)</span>, <span class="token number">2</span> <span class="token punctuation">(</span>n.sid<span class="token punctuation">)</span>, 0x4 <span class="token punctuation">(</span>n.peerEpoch<span class="token punctuation">)</span> LOOKING <span class="token punctuation">(</span>my state<span class="token punctuation">)</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>QuorumPeer<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>/0:0:0:0:0:0:0:0:2181:QuorumPeer@935<span class="token punctuation">]</span> - FOLLOWING
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>QuorumPeer<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>/0:0:0:0:0:0:0:0:2181:Learner@86<span class="token punctuation">]</span> - TCP NoDelay <span class="token builtin class-name">set</span> to: <span class="token boolean">true</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>QuorumPeer<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>/0:0:0:0:0:0:0:0:2181:Follower@64<span class="token punctuation">]</span> - FOLLOWING - LEADER ELECTION TOOK - <span class="token number">82</span>
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>QuorumPeer<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>/0:0:0:0:0:0:0:0:2181:QuorumPeer<span class="token variable">$QuorumServer</span>@167<span class="token punctuation">]</span> - Resolved hostname: zk-1.zk-hs.zookeeper.svc.cluster.local to address: zk-1.zk-hs.zookeeper.svc.cluster.local/10.244.4.6
<span class="token punctuation">[</span>myid:3<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>QuorumPeer<span class="token punctuation">[</span>myid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span>/0:0:0:0:0:0:0:0:2181:Learner@332<span class="token punctuation">]</span> - Getting a <span class="token function">diff</span> from the leader 0x300000004</code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;zk-<span class="token variable">$i</span>&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> srvr <span class="token operator">|</span> kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> zk-<span class="token variable">$i</span> -- <span class="token function">nc</span> <span class="token number">127.0</span>.0.1 <span class="token number">2181</span> <span class="token operator">|</span> <span class="token function">grep</span> Mode<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>  <span class="token keyword">done</span></code></pre></div><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">zk-0
Mode: follower

zk-1
Mode: leader

zk-2
Mode: follower</code></pre></div><h2 id="마무리" style="position:relative"><a href="#%EB%A7%88%EB%AC%B4%EB%A6%AC" aria-label="마무리 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>마무리</h2><p>Zookeeper를 사용하는 오픈소스 솔루션을 쓰고 있지만, 직접 제어할 일이 없어서 이해도가 낮았는데 이번 기회에 조금이나마 이해하게된 시간이 되었습니다.</p><p>Zookeeper 자체가 고가용성에 특화되어 있지만, 쿠버네티스의 기능을 활용하면 강력한 시너지 효과가 나는것을 몸소 느꼈네요!</p><p>추후 과제로는 Kafka와 Clickhouse에서는 Zookeeper를 어떻게 활용하고 있는지도 심도있게 살펴봐야겠습니다. (물론, Kafka와 Clickhouse 모두 Zookeeper 종속성을 없애기 위해 자체 코디네이터를 만들어 왔고 최근에 적용도 되었지만, 과거를 알아야 현재 구성에 대해 이해할 수 있다고 생각하기에 공부는 꼭 해봐야 할듯합니다!)</p><h2 id="참고-자료" style="position:relative"><a href="#%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C" aria-label="참고 자료 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>참고 자료</h2><ul><li><p><a href="https://kubernetes.io/docs/tutorials/stateful-application/zookeeper/">Running ZooKeeper, A Distributed System Coordinator</a></p></li><li><p><a href="https://d2.naver.com/helloworld/294797">ZooKeeper를 활용한 Redis Cluster 관리</a></p></li><li><p><a href="https://d2.naver.com/helloworld/583580">손쉽게 사용하는 ZooKeeper 스토리지, Zoopiter!</a></p></li><li><p><a href="https://bcho.tistory.com/1016">분산 코디네이터 Zookeeper(주키퍼) 소개</a></p></li><li><p><a href="https://www.mantech.co.kr/quorum/">Quorum에 대하여</a></p></li></ul></div></section><footer class="Article__ArticleFooter-sc-jwdbi9-1 jJwhJP"><div class="Bio__BioWrapper-sc-d7fgaq-0 LLImc"><figure class="author-image"><div alt="Sungchul Park" style="background-image:url(&quot;/static/f44b04687339c42b72dd22b8447a726f/66640/icon.png&quot;)" class="img"></div></figure><section><h4>About the author</h4><p class="Commons__Text-sc-1aaxjtz-1 Bio__BioText-sc-d7fgaq-1 fCQgYt kJMedD">
  배움을 멈추지 않고, 언젠가 넓고 깊은 지식을 갖게 되기를 꿈꾸고 있습니다! 🚀 <br>
  또한 누군가에게 선한 영향력을 미칠 수 있는 사람이 되기를 소망합니다 🌟
  </p></section></div></footer></article> </main><main role="main" class="Wrapper-sc-xmiwfw-0 gLFCRx"><div class="comments-wrapper"><div>Loading script...</div><div></div></div></main> <aside class="PrevNextPost__PreviewContainer-sc-1r1qyep-0 ljGRQe"><article class="PrevNextPost__Preview-sc-1r1qyep-1 kQwcEm"><a aria-label="View AWS Summit 2022 강연 정리 - Data Mesh article" href="/aws-summit-data-mesh"><div style="background-image:url(&quot;/static/8c1b6e0ad2a523f4cd8e0dbf4b45f9db/aws-summit-2022.png&quot;)" class="PrevNextPost__PreviewCover-sc-1r1qyep-2 gWjtnY"></div><div class="PrevNextPost__PreviewContent-sc-1r1qyep-3 fnSZzA"><header><h2>AWS Summit 2022 강연 정리 - Data Mesh</h2></header><section><p>Data Mesh 아키텍처 등장 배경과 기본개념, AWS기반 구성 방식, 실제 적용 사례를 소개합니다.
구체적인 구현 방법까지는 다루지 않으며, 아키텍처에 사용된 AWS 서비스에 대한 상세한 설명 또한 생략합니다. 본 글은 “AWS Summit…</p></section><footer><span class="Commons__ReadingTimeContainer-sc-1aaxjtz-3 bbCAMJ">5<!-- --> min read</span><span class="Commons__Bull-sc-1aaxjtz-2 bbfjCq"></span><div class="TagList__ListContainer-sc-tgjq80-0 lhQztB"><span to="/tags/aws" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">aws</span>, <span to="/tags/summit" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">summit</span>, <span to="/tags/datamesh" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">datamesh</span>, <span to="/tags/lakehouse" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">lakehouse</span>, <span to="/tags/datalake" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">datalake</span></div></footer></div></a></article><article class="PrevNextPost__Preview-sc-1r1qyep-1 kQwcEm"><a aria-label="View Snowplow로 데이터 파이프라인 구축하기(feat. 쿠버네티스) article" href="/snowplow-on-k8s"><div style="background-image:url(&quot;/static/7c97972dea5967c954e269382f736784/ee604/georgia.png&quot;)" class="PrevNextPost__PreviewCover-sc-1r1qyep-2 gWjtnY"></div><div class="PrevNextPost__PreviewContent-sc-1r1qyep-3 fnSZzA"><header><h2>Snowplow로 데이터 파이프라인 구축하기(feat. 쿠버네티스)</h2></header><section><p>…</p></section><footer><span class="Commons__ReadingTimeContainer-sc-1aaxjtz-3 bbCAMJ">3<!-- --> min read</span><span class="Commons__Bull-sc-1aaxjtz-2 bbfjCq"></span><div class="TagList__ListContainer-sc-tgjq80-0 lhQztB"><span to="/tags/kubernetes" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">kubernetes</span>, <span to="/tags/snowplow" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">snowplow</span>, <span to="/tags/data" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">data</span>, <span to="/tags/pipeline" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">pipeline</span>, <span to="/tags/platform" class="TagList__TagListItem-sc-tgjq80-2 kWMwkB">platform</span></div></footer></div></a></article></aside> <!-- --> </div><footer class="Footer__FooterWrapper-sc-t92llg-0 bZZuNd"><nav><div class="footer-col"><h5 class="footer-title">Sungchul Park<!-- --> © <!-- -->2023</h5><p class="footer-item-text">Built with<!-- --> <a class="footer-link" href="https://www.gatsbyjs.org">Gatsby</a>.</p><p class="footer-item-text">Theme using<!-- --> <a class="footer-link" href="https://github.com/maxpou/gatsby-starter-morning-dew">gatsby-starter-morning-dew</a>.</p><p class="footer-item-text">Hosted with<!-- --> <span class="footer-heart" role="img" aria-label="Love">❤</span> <!-- -->by<!-- --> <a class="footer-link" href="https://github.com">GitHub</a>.</p></div><div class="footer-col"><h5 class="footer-title">Explore</h5><span class="footer-item"><a class="footer-link" href="/">Blog</a></span><span class="footer-item"><a class="footer-link" href="/about-me">About</a></span></div><div class="footer-col"><h5 class="footer-title">Follow the author</h5><span class="footer-item"><a class="footer-link" href="https://github.com/Sungchul-P/Sungchul-P.github.io">GitHub</a></span><span class="footer-item"><a class="footer-link" href="https://Sungchul-P.github.io/">Website</a></span></div></nav></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://cdn.panelbear.com/analytics.js?site=AVlbX7MNoAU"></script><script>
          window.panelbear = window.panelbear || function() { (window.panelbear.q = window.panelbear.q || []).push(arguments); };
          panelbear('config', {"site":"AVlbX7MNoAU","spaMode":"history","debug":false});
        </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/zookeeper-on-k8s";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9e490ddcf07d7db5763c.js"],"app":["/app-b3fd3eb1dc260f918a8b.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-46b4173e1060a5c82475.js"],"component---src-pages-404-js":["/component---src-pages-404-js-a72ee7ffca8b83238a2b.js"],"component---src-templates-blog-list-template-js":["/component---src-templates-blog-list-template-js-54561993b6a7096d46a2.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-73aef64fd53c7c31b11f.js"],"component---src-templates-page-js":["/component---src-templates-page-js-0b5bdd29587c20861475.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-0ddf0482cd140cfb2415.js"]};/*]]>*/</script><script src="/polyfill-9e490ddcf07d7db5763c.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-73aef64fd53c7c31b11f.js" async=""></script><script src="/3a2f1ab89072400eb78a258db61265f1964eff8a-8f8eed1747c24875300b.js" async=""></script><script src="/styles-29147cbc04bbc833f6a0.js" async=""></script><script src="/app-b3fd3eb1dc260f918a8b.js" async=""></script><script src="/framework-8de36d3fd07627b19105.js" async=""></script><script src="/webpack-runtime-3addde89858b18712ae3.js" async=""></script></body></html>